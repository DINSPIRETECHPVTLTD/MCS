<ion-header [translucent]="false">
  <ion-toolbar>
    <ion-title>{{ isEditing ? 'Edit Staff' : 'Add New Staff' }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="closeModal()">
        <ion-icon name="close-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <form [formGroup]="staffForm" (ngSubmit)="onSubmit()">
    <!-- Name Fields -->
    <ion-item [class.ion-invalid]="isFieldInvalid('firstName')">
      <ion-label position="stacked">First Name <span class="required">*</span></ion-label>
      <ion-input
        formControlName="firstName"
        placeholder="Enter first name"
        type="text"
        maxlength="100"
        (ionInput)="onFirstNameInput($event)">
      </ion-input>
      <ion-note slot="error">
        <div *ngIf="staffForm.get('firstName')?.errors?.['required']">First name is required</div>
        <div *ngIf="staffForm.get('firstName')?.errors?.['maxlength']">First name must be at most 100 characters</div>
        <div *ngIf="staffForm.get('firstName')?.errors?.['pattern']">First name must be alphanumeric</div>
      </ion-note>
    </ion-item>

    <ion-item [class.ion-invalid]="isFieldInvalid('middleName')">
      <ion-label position="stacked">Middle Name <span class="required">*</span></ion-label>
      <ion-input
        formControlName="middleName"
        placeholder="Enter middle name"
        type="text"
        maxlength="100"
        (ionInput)="onMiddleNameInput($event)">
      </ion-input>
      <ion-note slot="error">
        <div *ngIf="staffForm.get('middleName')?.errors?.['required']">Middle name is required</div>
        <div *ngIf="staffForm.get('middleName')?.errors?.['maxlength']">Middle name must be at most 100 characters</div>
        <div *ngIf="staffForm.get('middleName')?.errors?.['pattern']">Middle name must be alphanumeric</div>
      </ion-note>
    </ion-item>

    <ion-item [class.ion-invalid]="isFieldInvalid('lastName')">
      <ion-label position="stacked">Last Name <span class="required">*</span></ion-label>
      <ion-input
        formControlName="lastName"
        placeholder="Enter last name"
        type="text"
        maxlength="100"
        (ionInput)="onLastNameInput($event)">
      </ion-input>
      <ion-note slot="error">
        <div *ngIf="staffForm.get('lastName')?.errors?.['required']">Last name is required</div>
        <div *ngIf="staffForm.get('lastName')?.errors?.['maxlength']">Last name must be at most 100 characters</div>
        <div *ngIf="staffForm.get('lastName')?.errors?.['pattern']">Last name must be alphanumeric</div>
      </ion-note>
    </ion-item>

    <!-- Contact Fields -->
    <ion-item [class.ion-invalid]="isFieldInvalid('phoneNumber')">
      <ion-label position="stacked">Phone Number <span class="required">*</span></ion-label>
      <ion-input
        formControlName="phoneNumber"
        placeholder="Enter 10-digit phone number"
        type="tel"
        maxlength="10"
        (ionInput)="onPhoneInput($event)">
      </ion-input>
      <ion-note slot="error">{{ getFieldError('phoneNumber') }}</ion-note>
    </ion-item>

    <!-- Email and Password Fields -->
    <ion-item [class.ion-invalid]="isFieldInvalid('email')">
      <ion-label position="stacked">Email ID <span class="required">*</span></ion-label>
      <ion-input
        formControlName="email"
        placeholder="Enter email address"
        type="email"
        maxlength="100"
        (ionInput)="onEmailInput($event)">
      </ion-input>
      <ion-note slot="error">{{ getFieldError('email') }}</ion-note>
    </ion-item>

    <ion-item [class.ion-invalid]="isFieldInvalid('password')">
      <ion-label position="stacked">Password <span *ngIf="!isEditing" class="required">*</span></ion-label>
      <ion-input
        formControlName="password"
        placeholder="Enter password"
        type="password"
        maxlength="12"
        (ionInput)="onPasswordInput($event)">
      </ion-input>
      <ion-note slot="error">{{ getFieldError('password') }}</ion-note>
    </ion-item>

    <!-- Address Fields -->
    <ion-item>
      <ion-label position="stacked">Address Line 1 <span class="required">*</span></ion-label>
      <ion-input
        formControlName="address1"
        placeholder="Enter address line 1"
        type="text"
        maxlength="100"
        (ionInput)="onAddressInput($event, 'address1')">
      </ion-input>
      <ion-note slot="error">{{ getFieldError('address1') }}</ion-note>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Address Line 2 <span class="required">*</span></ion-label>
      <ion-input
        formControlName="address2"
        placeholder="Enter address line 2"
        type="text"
        maxlength="100"
        (ionInput)="onAddressInput($event, 'address2')">
      </ion-input>
      <ion-note slot="error">{{ getFieldError('address2') }}</ion-note>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">City <span class="required">*</span></ion-label>
      <ion-input
        formControlName="city"
        placeholder="Enter city"
        type="text"
        maxlength="100"
        (ionInput)="onAddressInput($event, 'city')">
      </ion-input>
      <ion-note slot="error">{{ getFieldError('city') }}</ion-note>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">State <span class="required">*</span></ion-label>
      <ion-input
        formControlName="state"
        placeholder="Enter state"
        type="text"
        maxlength="100"
        (ionInput)="onAddressInput($event, 'state')">
      </ion-input>
      <ion-note slot="error">{{ getFieldError('state') }}</ion-note>
    </ion-item>

    <ion-item [class.ion-invalid]="isFieldInvalid('pinCode')">
      <ion-label position="stacked">Pin Code <span class="required">*</span></ion-label>
      <ion-input
        formControlName="pinCode"
        placeholder="Enter 6-digit pin code"
        type="tel"
        maxlength="6"
        (ionInput)="onPinInput($event)">
      </ion-input>
      <ion-note slot="error">{{ getFieldError('pinCode') }}</ion-note>
    </ion-item>

    <!-- Role Field -->
    <ion-item [class.ion-invalid]="isFieldInvalid('role')">
      <ion-label position="stacked">Role <span class="required">*</span></ion-label>
      <ion-select formControlName="role" interface="popover" placeholder="Select role">
        <ion-select-option value="BranchAdmin">Branch Admin</ion-select-option>
        <ion-select-option value="Staff">Staff</ion-select-option>
      </ion-select>
      <ion-note slot="error">{{ getFieldError('role') }}</ion-note>
    </ion-item>

  </form>

</ion-content>

<ion-footer>
  <ion-toolbar class="footer-toolbar">
    <div class="footer-actions">
      <div class="left-action">
        <ion-button class="save-btn" color="primary" fill="solid" (click)="onSubmit()" [disabled]="staffForm.invalid">
          <ion-icon slot="start" name="checkmark-outline"></ion-icon>
          <span class="btn-text">Save Changes</span>
        </ion-button>
      </div>

      <div class="right-actions">
        <ion-button class="cancel-btn" type="button" fill="outline" (click)="closeModal()">Cancel</ion-button>
      </div>
    </div>
  </ion-toolbar>
</ion-footer>
