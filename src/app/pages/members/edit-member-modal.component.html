<ion-header [translucent]="false">
  <ion-toolbar>
    <ion-title>Edit Member</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="onCancel()">
        <ion-icon name="close-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding edit-member-content">
  <form class="edit-member-form" [formGroup]="memberForm" (ngSubmit)="onSave()">
    <!-- Section 1: Member Identification -->
    <div class="section-card">
      <div class="section-title">Member Identification</div>
      <div class="form-row">
        <ion-item>
          <ion-label position="stacked">Member ID/Code</ion-label>
          <ion-input formControlName="memberId" type="text" readonly></ion-input>
        </ion-item>
      </div>
    </div>

     <!-- Section 2: Assignment Details -->
    <div class="section-card">
      <div class="section-title">Assignment Details</div>
      <div class="form-row form-row--two-col">
        <ion-item [class.ion-invalid]="isFieldInvalid('centerId')">
          <ion-label position="stacked">Center <span class="required">*</span></ion-label>
          <ion-select formControlName="centerId" interface="popover" placeholder="Select Center">
            <ion-select-option [value]="''">Select Center</ion-select-option>
            <ion-select-option *ngFor="let center of centers" [value]="center.id">{{ center.name }}</ion-select-option>
          </ion-select>
          <ion-note slot="error">{{ getFieldError('centerId') }}</ion-note>
        </ion-item>
        <ion-item [class.ion-invalid]="isFieldInvalid('pocId')">
          <ion-label position="stacked">POC (Point of Contact) <span class="required">*</span></ion-label>
          <ion-select formControlName="pocId" interface="popover" placeholder="Select POC" [disabled]="pocs.length === 0">
            <ion-select-option [value]="''">Select POC</ion-select-option>
            <ion-select-option *ngFor="let poc of pocs" [value]="poc.id">{{ poc.name }}</ion-select-option>
          </ion-select>
          <ion-note slot="error">{{ getFieldError('pocId') }}</ion-note>
        </ion-item>
      </div>
    </div>
    
    <!-- Section 3: Member Personal Details -->
    <div class="section-card section-card--alt">
      <div class="section-title">Member Personal Details</div>
      <div class="form-row">
        <ion-item [class.ion-invalid]="isFieldInvalid('firstName')">
          <ion-label position="stacked">First Name <span class="required">*</span></ion-label>
          <ion-input formControlName="firstName" type="text" maxlength="50" placeholder="Enter first name"></ion-input>
          <ion-note slot="error">{{ getFieldError('firstName') }}</ion-note>
        </ion-item>
        <ion-item [class.ion-invalid]="isFieldInvalid('lastName')">
          <ion-label position="stacked">Surname <span class="required">*</span></ion-label>
          <ion-input formControlName="lastName" type="text" maxlength="50" placeholder="Enter surname"></ion-input>
          <ion-note slot="error">{{ getFieldError('lastName') }}</ion-note>
        </ion-item>
        <ion-item [class.ion-invalid]="isFieldInvalid('occupation')">
          <ion-label position="stacked">Occupation <span class="required">*</span></ion-label>
          <ion-input formControlName="occupation" type="text" maxlength="100" placeholder="Enter occupation"></ion-input>
          <ion-note slot="error">{{ getFieldError('occupation') }}</ion-note>
        </ion-item>
      </div>
      <div class="form-row">
        <ion-item [class.ion-invalid]="isFieldInvalid('dateOfBirth')">
          <ion-label position="stacked">Date of Birth <span class="required">*</span></ion-label>
          <ion-input formControlName="dateOfBirth" type="date" [max]="todayString"></ion-input>
          <ion-note slot="error">{{ getFieldError('dateOfBirth') }}</ion-note>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Age</ion-label>
          <ion-input formControlName="age" type="text" readonly placeholder="Auto-calculated"></ion-input>
          <ion-note slot="error">{{ getFieldError('age') }}</ion-note>
        </ion-item>
        <ion-item [class.ion-invalid]="isFieldInvalid('phoneNumber')">
          <ion-label position="stacked">Phone Number <span class="required">*</span></ion-label>
          <ion-input formControlName="phoneNumber" type="tel" maxlength="10" inputmode="numeric" placeholder="Enter phone number"></ion-input>
          <ion-note slot="error">{{ getFieldError('phoneNumber') }}</ion-note>
        </ion-item>
      </div>
      <div class="form-row">
        <ion-item [class.ion-invalid]="isFieldInvalid('aadhaar')">
          <ion-label position="stacked">Aadhaar <span class="required">*</span></ion-label>
          <ion-input formControlName="aadhaar" type="tel" maxlength="12" inputmode="numeric" placeholder="Enter Aadhaar"></ion-input>
          <ion-note slot="error">{{ getFieldError('aadhaar') }}</ion-note>
        </ion-item>
      </div>
    </div>


    <!-- Section 4: Member Address Details -->
    <div class="section-card section-card--alt">
      <div class="section-title">Member Address Details</div>
      <div class="form-row">
        <ion-item [class.ion-invalid]="isFieldInvalid('address1')">
          <ion-label position="stacked">Address Line 1 <span class="required">*</span></ion-label>
          <ion-input formControlName="address1" type="text" maxlength="200" placeholder="Enter address line 1"></ion-input>
          <ion-note slot="error">{{ getFieldError('address1') }}</ion-note>
        </ion-item>
        <ion-item [class.ion-invalid]="isFieldInvalid('address2')">
          <ion-label position="stacked">Address Line 2</ion-label>
          <ion-input formControlName="address2" type="text" maxlength="200" placeholder="Enter address line 2"></ion-input>
          <ion-note slot="error">{{ getFieldError('address2') }}</ion-note>
        </ion-item>
        <ion-item [class.ion-invalid]="isFieldInvalid('city')">
          <ion-label position="stacked">City <span class="required">*</span></ion-label>
          <ion-input formControlName="city" type="text" maxlength="100" placeholder="Enter city"></ion-input>
          <ion-note slot="error">{{ getFieldError('city') }}</ion-note>
        </ion-item>
      </div>
      <div class="form-row">
        <ion-item [class.ion-invalid]="isFieldInvalid('state')">
          <ion-label position="stacked">State <span class="required">*</span></ion-label>
          <ion-select formControlName="state" placeholder="Select a state" interface="popover">
            <ion-select-option value="">Select a state</ion-select-option>
            <ion-select-option *ngFor="let state of states" [value]="state.lookupCode">{{ state.lookupValue }}</ion-select-option>
          </ion-select>
          <ion-note slot="error">{{ getFieldError('state') }}</ion-note>
        </ion-item>
        <ion-item [class.ion-invalid]="isFieldInvalid('zipCode')">
          <ion-label position="stacked">Pincode <span class="required">*</span></ion-label>
          <ion-input formControlName="zipCode" type="text" maxlength="6" placeholder="Enter pincode"></ion-input>
          <ion-note slot="error">{{ getFieldError('zipCode') }}</ion-note>
        </ion-item>
      </div>
    </div>

    <!-- Section 5: Guardian/Husband Details -->
    <div class="section-card section-card--alt">
      <div class="section-title">Guardian/Husband Details</div>
      <div class="form-row">
        <ion-item [class.ion-invalid]="isFieldInvalid('guardianFirstName')">
          <ion-label position="stacked">Guardian First Name <span class="required">*</span></ion-label>
          <ion-input formControlName="guardianFirstName" type="text" maxlength="100" placeholder="Enter first name"></ion-input>
          <ion-note slot="error">{{ getFieldError('guardianFirstName') }}</ion-note>
        </ion-item>
        <ion-item [class.ion-invalid]="isFieldInvalid('guardianLastName')">
          <ion-label position="stacked">Guardian Surname <span class="required">*</span></ion-label>
          <ion-input formControlName="guardianLastName" type="text" maxlength="100" placeholder="Enter surname"></ion-input>
          <ion-note slot="error">{{ getFieldError('guardianLastName') }}</ion-note>
        </ion-item>
        <ion-item [class.ion-invalid]="isFieldInvalid('guardianPhone')">
          <ion-label position="stacked">Phone Number</ion-label>
          <ion-input formControlName="guardianPhone" type="tel" maxlength="10" inputmode="numeric" placeholder="Enter phone number"></ion-input>
          <ion-note slot="error">{{ getFieldError('guardianPhone') }}</ion-note>
        </ion-item>
      </div>
      <div class="form-row">
        <ion-item [class.ion-invalid]="isFieldInvalid('guardianDOB')">
          <ion-label position="stacked">Guardian DOB <span class="required">*</span></ion-label>
          <ion-input formControlName="guardianDOB" type="date" [max]="todayString"></ion-input>
          <ion-note slot="error">{{ getFieldError('guardianDOB') }}</ion-note>
        </ion-item>
        <ion-item [class.ion-invalid]="isFieldInvalid('guardianAge')">
          <ion-label position="stacked">Guardian Age</ion-label>
          <ion-input
            formControlName="guardianAge"
            type="number"
            min="18"
            max="150"
            [readonly]="!!memberForm.get('guardianDOB')?.value"
            [placeholder]="memberForm.get('guardianDOB')?.value ? 'Auto-calculated' : '18+'"></ion-input>
          <ion-note slot="error">{{ getFieldError('guardianAge') }}</ion-note>
        </ion-item>
      </div>
    </div>

   
  </form>
</ion-content>

<ion-footer>
  <ion-toolbar class="footer-toolbar">
    <div class="footer-actions">
      <div class="left-action">
        <ion-button class="save-btn" color="primary" fill="solid" (click)="onSave()" [disabled]="isSubmitting || memberForm.invalid">
          <span class="btn-text">Update Member</span>
        </ion-button>
      </div>
      <div class="right-actions">
        <ion-button type="button" fill="outline" (click)="onCancel()" class="cancel-btn">Cancel</ion-button>
      </div>
    </div>
  </ion-toolbar>
</ion-footer>

<div *ngIf="isLoading" class="loading-overlay">
  <ion-spinner name="crescent"></ion-spinner>
  <p>Loading data...</p>
</div>
