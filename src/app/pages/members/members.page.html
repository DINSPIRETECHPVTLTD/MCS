<app-header-menu 
  [activeMenu]="activeMenu"
  (menuChange)="onMenuChange($event)"
  (branchChange)="onBranchChange($event)">
</app-header-menu>

<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Members List -->
  <div class="users-list-container">
    <div class="members-toolbar">
      <div class="members-toolbar-left">
        <h2>All Members</h2>
      </div>

      <div class="members-actions">
        <ion-button (click)="onViewMembers()">
          <ion-icon name="list-outline" slot="start"></ion-icon>
          View Members
        </ion-button>
        <ion-button (click)="openAddMemberModal()">
          <ion-icon name="person-add-outline" slot="start"></ion-icon>
          Add Member
        </ion-button>
      </div>
    </div>

    <mat-card class="filter-card">
      <div class="filter-row">
        <mat-form-field *ngIf="isViewMembersClicked" appearance="outline" class="filter-field">
          <mat-label>Center Name</mat-label>
          <mat-select
            [(ngModel)]="selectedCenterId"
            (selectionChange)="onCenterChange($event.value)"
            [disabled]="!isViewMembersClicked">
            <mat-option *ngFor="let c of centers" [value]="c.id">{{ c.name }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field *ngIf="showSearch" appearance="outline" class="filter-field filter-field--search">
          <mat-label>Search members</mat-label>
          <input matInput (input)="onFilterChange($event)" />
        </mat-form-field>
      </div>
    </mat-card>

    <div *ngIf="rowData.length === 0 && !isLoading" class="empty-state">
      <ion-icon name="people-outline" size="large"></ion-icon>
      <p>No members found</p>
      <p style="font-size: 12px; margin-top: 8px; color: var(--ion-color-medium);">
        Click "Add Member" to add a new member
      </p>
    </div>

    <div *ngIf="rowData.length > 0" class="users-grid">
      <div class="table-scroll">
        <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 members-table">

        <ng-container matColumnDef="memberFirstName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>First Name</th>
          <td mat-cell *matCellDef="let row">{{ row.memberFirstName }}</td>
        </ng-container>

        <ng-container matColumnDef="memberMiddleName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Middle Name</th>
          <td mat-cell *matCellDef="let row">{{ row.memberMiddleName }}</td>
        </ng-container>

        <ng-container matColumnDef="memberLastName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Last Name</th>
          <td mat-cell *matCellDef="let row">{{ row.memberLastName }}</td>
        </ng-container>

        <ng-container matColumnDef="memberDob">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>DOB</th>
          <td mat-cell *matCellDef="let row">{{ row.memberDob | date:'dd/MM/yyyy' }}</td>
        </ng-container>

        <ng-container matColumnDef="memberAge">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Age</th>
          <td mat-cell *matCellDef="let row">{{ row.memberAge }}</td>
        </ng-container>

        <ng-container matColumnDef="memberPhone">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Phone No</th>
          <td mat-cell *matCellDef="let row">{{ row.memberPhone }}</td>
        </ng-container>

        <ng-container matColumnDef="memberAddress">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Address</th>
          <td mat-cell *matCellDef="let row">
            <span class="truncate truncate--address" [title]="row.memberAddress">{{ row.memberAddress }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="memberAadhaar">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Aadhaar</th>
          <td mat-cell *matCellDef="let row">
            <span class="truncate truncate--aadhaar" [title]="row.memberAadhaar">{{ row.memberAadhaar }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="memberOccupation">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Occupation</th>
          <td mat-cell *matCellDef="let row">{{ row.memberOccupation }}</td>
        </ng-container>

        <ng-container matColumnDef="memberStatus">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
          <td mat-cell *matCellDef="let row">
            <span
              class="status-badge"
              [ngClass]="row.memberStatus === 'Active' ? 'status-active' : 'status-inactive'">
              {{ row.memberStatus || 'Inactive' }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="guardianName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Husband / Guardian Name</th>
          <td mat-cell *matCellDef="let row">{{ row.guardianName }}</td>
        </ng-container>

        <ng-container matColumnDef="guardianAge">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Husband / Guardian Age</th>
          <td mat-cell *matCellDef="let row">{{ row.guardianAge }}</td>
        </ng-container>

        <ng-container matColumnDef="branch">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Branch</th>
          <td mat-cell *matCellDef="let row">{{ row.branch }}</td>
        </ng-container>

        <ng-container matColumnDef="center">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Center</th>
          <td mat-cell *matCellDef="let row">{{ row.center }}</td>
        </ng-container>

        <ng-container matColumnDef="poc">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>POC</th>
          <td mat-cell *matCellDef="let row">
            <span class="truncate truncate--poc" [title]="row.poc">{{ row.poc }}</span>
          </td>
        </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>

      <mat-paginator [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons></mat-paginator>
    </div>
  </div>
</ion-content>

