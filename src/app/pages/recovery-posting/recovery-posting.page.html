<app-header-menu 
  [activeMenu]="activeMenu"
  (menuChange)="onMenuChange($event)"
  (branchChange)="onBranchChange($event)">
  <ion-content [fullscreen]="true" class="ion-padding">
  <div class="content-container">
    <div class="page-header">
      <h1>Recovery Posting</h1>
      <div class="date-display">
        <ion-icon name="calendar-outline"></ion-icon>
        <span>{{ selectedDateDisplay }}</span>
      </div>
    </div>
    
    <!-- Filter Section: sequence Date → Center → POC; results match all selected conditions -->
    <ion-card class="filter-card">
      <ion-card-content>
        <div class="filter-section">
          <div class="form-row form-row--filters">
            <ion-item>
              <ion-label position="stacked">Select Date <span class="filter-step">(Step 1)</span></ion-label>
              <ion-input
                [(ngModel)]="selectedDate"
                name="selectedDate"
                type="date"
                (ionChange)="onDateChange()">
              </ion-input>
            </ion-item>
            <ion-item>
              <ion-label position="stacked">Center <span class="filter-step">(Step 2)</span></ion-label>
              <ion-select
                [(ngModel)]="selectedCenter"
                (ionChange)="onCenterChange()"
                placeholder="Select Center"
                interface="popover">
                <ion-select-option [value]="">Select Center</ion-select-option>
                <ion-select-option *ngFor="let center of centers" [value]="center.id + ''">
                  {{ center.code ? center.code + ' - ' + center.name : center.name }}
                </ion-select-option>
              </ion-select>
            </ion-item>
            <ion-item>
              <ion-label position="stacked">POC <span class="filter-step">(Step 3)</span></ion-label>
              <ion-select
                [(ngModel)]="selectedPoc"
                (ionChange)="onPocChange()"
                placeholder="Select POC"
                interface="popover"
                [disabled]="!selectedCenter || pocs.length === 0">
                <ion-select-option [value]="">Select POC</ion-select-option>
                <ion-select-option *ngFor="let poc of pocs" [value]="poc.id">
                  {{ getPocDisplayName(poc) }}
                </ion-select-option>
              </ion-select>
            </ion-item>
            <ion-item>
              <ion-label position="stacked">Collected By</ion-label>
              <ion-select
                [(ngModel)]="selectedCollectBy"
                (ionChange)="onCollectByChange()"
                placeholder="Select Collect By"
                interface="popover">
                <ion-select-option [value]="">Select Collect By</ion-select-option>
                <ion-select-option *ngFor="let user of users" [value]="user.id">
                  {{ getUserDisplayName(user) }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </div>

          <!-- Action Buttons -->
          <div class="filter-group action-buttons">
            <div class="total-amount-collected" [class.has-value]="totalAmountCollected > 0">
              <div class="total-label">Total Amount Collected</div>
              <div class="total-value">₹ {{ totalAmountCollected | number:'1.2-2' }}</div>
            </div>
            <ion-button color="primary" fill="solid" (click)="postSelected()">
              <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
              POST
            </ion-button>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Action Bar -->
    <div class="action-bar">
      <span class="action-hint">Select one or more members with the checkboxes, then click POST.</span>
    </div>

    <!-- AG Grid -->
    <div class="grid-container">
      <div *ngIf="isLoading" class="loading-state">
        <ion-spinner></ion-spinner>
        <p>Loading recovery posting data...</p>
      </div>
      
      <div *ngIf="!isLoading && rowData.length === 0" class="empty-state">
        <ion-icon name="document-text-outline" size="large"></ion-icon>
        <p>No recovery posting data found</p>
        <p style="font-size: 12px; margin-top: 8px; color: var(--ion-color-medium);">
          Adjust filters or check back later
        </p>
      </div>
      
      <div *ngIf="!isLoading && rowData.length > 0" class="grid-wrapper">
        <ag-grid-angular
          class="ag-theme-alpine"
          style="width: 100%; height: 100%;"
          [gridOptions]="gridOptions"
          [rowData]="rowData"
          [columnDefs]="columnDefs"
          [defaultColDef]="defaultColDef"
          [pagination]="pagination"
          [paginationPageSize]="paginationPageSize"
          (gridReady)="onGridReady($event)">
        </ag-grid-angular>
      </div>
    </div>
  </div>
  </ion-content>
</app-header-menu>
